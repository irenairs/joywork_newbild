<template>
  <div class="chessFacade">
    <button
      class="prev"
      @click="changeFacade('prev')"
      v-if="facades.length > 1"
    >
      <svg
        width="100"
        height="100"
        viewBox="0 0 100 100"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M78.125 5.46875H21.875C17.5251 5.47289 13.3545 7.20273 10.2786 10.2786C7.20273 13.3545 5.47289 17.5251 5.46875 21.875V78.125C5.47289 82.4749 7.20273 86.6455 10.2786 89.7214C13.3545 92.7973 17.5251 94.5271 21.875 94.5312H78.125C82.4749 94.5271 86.6455 92.7973 89.7214 89.7214C92.7973 86.6455 94.5271 82.4749 94.5312 78.125V21.875C94.5271 17.5251 92.7973 13.3545 89.7214 10.2786C86.6455 7.20273 82.4749 5.47289 78.125 5.46875ZM80.2188 27.6094C80.2188 27.8166 80.1364 28.0153 79.9899 28.1618C79.8434 28.3083 79.6447 28.3906 79.4375 28.3906C67.6461 28.4168 56.3154 32.9715 47.7865 41.1136C39.2575 49.2558 34.1823 60.3632 33.6094 72.1406L42.8594 62.875C43.0061 62.7335 43.2024 62.655 43.4062 62.6562C43.6149 62.6542 43.8163 62.7326 43.9688 62.875L47.3438 66.2656C47.4869 66.4117 47.5671 66.608 47.5671 66.8125C47.5671 67.017 47.4869 67.2133 47.3438 67.3594L30.9375 83.8125C30.787 83.9531 30.5888 84.0313 30.3828 84.0313C30.1769 84.0313 29.9786 83.9531 29.8281 83.8125L13.4219 67.3906C13.3471 67.3205 13.2876 67.2358 13.2469 67.1417C13.2061 67.0477 13.1851 66.9462 13.1851 66.8438C13.1851 66.7413 13.2061 66.6399 13.2469 66.5458C13.2876 66.4517 13.3471 66.367 13.4219 66.2969L16.7969 62.9062C16.9455 62.7621 17.1445 62.6815 17.3516 62.6815C17.5586 62.6815 17.7576 62.7621 17.9062 62.9062L27.2812 72.2812C27.8254 58.7975 33.5591 46.0457 43.2844 36.6902C53.0097 27.3347 65.9741 22.0994 79.4688 22.0781C79.6759 22.0781 79.8747 22.1604 80.0212 22.3069C80.1677 22.4535 80.25 22.6522 80.25 22.8594L80.2188 27.6094Z"
          fill="#F3F3F3"
        />
        <path
          d="M80.2188 27.6094C80.2188 27.8166 80.1364 28.0153 79.9899 28.1618C79.8434 28.3083 79.6447 28.3906 79.4375 28.3906C67.6461 28.4168 56.3154 32.9715 47.7865 41.1136C39.2575 49.2558 34.1823 60.3632 33.6094 72.1406L42.8594 62.875C43.0061 62.7335 43.2024 62.655 43.4062 62.6562C43.6149 62.6542 43.8163 62.7326 43.9688 62.875L47.3438 66.2656C47.4869 66.4117 47.5671 66.608 47.5671 66.8125C47.5671 67.017 47.4869 67.2133 47.3438 67.3594L30.9375 83.8125C30.787 83.9531 30.5888 84.0313 30.3828 84.0313C30.1769 84.0313 29.9786 83.9531 29.8281 83.8125L13.4219 67.3906C13.3471 67.3205 13.2876 67.2358 13.2469 67.1417C13.2061 67.0477 13.1851 66.9462 13.1851 66.8438C13.1851 66.7413 13.2061 66.6399 13.2469 66.5458C13.2876 66.4517 13.3471 66.367 13.4219 66.2969L16.7969 62.9062C16.9455 62.7621 17.1445 62.6815 17.3516 62.6815C17.5586 62.6815 17.7576 62.7621 17.9062 62.9062L27.2812 72.2812C27.8254 58.7975 33.5591 46.0457 43.2844 36.6902C53.0097 27.3347 65.9741 22.0994 79.4688 22.0781C79.6759 22.0781 79.8747 22.1604 80.0212 22.3069C80.1677 22.4535 80.25 22.6522 80.25 22.8594L80.2188 27.6094Z"
          fill="#3E9842"
        />
      </svg>
    </button>
    <div class="map" id="map"></div>
    <button
      class="next"
      @click="changeFacade('next')"
      v-if="facades.length > 1"
    >
      <svg
        width="100"
        height="100"
        viewBox="0 0 100 100"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M21.875 5.46875H78.125C82.4749 5.47289 86.6455 7.20273 89.7214 10.2786C92.7973 13.3545 94.5271 17.5251 94.5312 21.875V78.125C94.5271 82.4749 92.7973 86.6455 89.7214 89.7214C86.6455 92.7973 82.4749 94.5271 78.125 94.5312H21.875C17.5251 94.5271 13.3545 92.7973 10.2786 89.7214C7.20273 86.6455 5.47289 82.4749 5.46875 78.125V21.875C5.47289 17.5251 7.20273 13.3545 10.2786 10.2786C13.3545 7.20273 17.5251 5.47289 21.875 5.46875ZM19.7812 27.6094C19.7812 27.8166 19.8636 28.0153 20.0101 28.1618C20.1566 28.3083 20.3553 28.3906 20.5625 28.3906C32.3539 28.4168 43.6846 32.9715 52.2135 41.1136C60.7425 49.2558 65.8177 60.3632 66.3906 72.1406L57.1406 62.875C56.9939 62.7335 56.7976 62.655 56.5938 62.6562C56.3851 62.6542 56.1837 62.7326 56.0312 62.875L52.6562 66.2656C52.5131 66.4117 52.4329 66.608 52.4329 66.8125C52.4329 67.017 52.5131 67.2133 52.6562 67.3594L69.0625 83.8125C69.213 83.9531 69.4112 84.0313 69.6172 84.0313C69.8231 84.0313 70.0214 83.9531 70.1719 83.8125L86.5781 67.3906C86.6529 67.3205 86.7124 67.2358 86.7531 67.1417C86.7939 67.0477 86.8149 66.9462 86.8149 66.8438C86.8149 66.7413 86.7939 66.6399 86.7531 66.5458C86.7124 66.4517 86.6529 66.367 86.5781 66.2969L83.2031 62.9062C83.0545 62.7621 82.8555 62.6815 82.6484 62.6815C82.4414 62.6815 82.2424 62.7621 82.0938 62.9062L72.7188 72.2812C72.1746 58.7975 66.4409 46.0457 56.7156 36.6902C46.9903 27.3347 34.0259 22.0994 20.5312 22.0781C20.3241 22.0781 20.1253 22.1604 19.9788 22.3069C19.8323 22.4535 19.75 22.6522 19.75 22.8594L19.7812 27.6094Z"
          fill="#F3F3F3"
        />
        <path
          d="M19.7812 27.6094C19.7812 27.8166 19.8636 28.0153 20.0101 28.1618C20.1566 28.3083 20.3553 28.3906 20.5625 28.3906C32.3539 28.4168 43.6846 32.9715 52.2135 41.1136C60.7425 49.2558 65.8177 60.3632 66.3906 72.1406L57.1406 62.875C56.9939 62.7335 56.7976 62.655 56.5938 62.6562C56.3851 62.6542 56.1837 62.7326 56.0312 62.875L52.6562 66.2656C52.5131 66.4117 52.4329 66.608 52.4329 66.8125C52.4329 67.017 52.5131 67.2133 52.6562 67.3594L69.0625 83.8125C69.213 83.9531 69.4112 84.0313 69.6172 84.0313C69.8231 84.0313 70.0214 83.9531 70.1719 83.8125L86.5781 67.3906C86.6529 67.3205 86.7124 67.2358 86.7531 67.1417C86.7939 67.0477 86.8149 66.9462 86.8149 66.8438C86.8149 66.7413 86.7939 66.6399 86.7531 66.5458C86.7124 66.4517 86.6529 66.367 86.5781 66.2969L83.2031 62.9062C83.0545 62.7621 82.8555 62.6815 82.6484 62.6815C82.4414 62.6815 82.2424 62.7621 82.0938 62.9062L72.7188 72.2812C72.1746 58.7975 66.4409 46.0457 56.7156 36.6902C46.9903 27.3347 34.0259 22.0994 20.5312 22.0781C20.3241 22.0781 20.1253 22.1604 19.9788 22.3069C19.8323 22.4535 19.75 22.6522 19.75 22.8594L19.7812 27.6094Z"
          fill="#3E9842"
        />
      </svg>
    </button>
    <PopupWindowViewFacade
      :floor-data="[]"
      :number-floor="Number(optionsFloor.floor)"
    />
  </div>
</template>

<script setup lang="ts">
import useViewFacades, { Facade } from "@/features/useViewFacades";
import { onMounted, ref, watch } from "vue";
import PopupWindowViewFacade from "./popupWindowViewFacade.vue";

const props = defineProps<{
  viewType: string;
}>();
const wrapper = ref<HTMLCanvasElement>();
const facades = ref<Facade[]>([
  {
    id: "1h475hf73md",
    image:
      "https://pb17884.profitbase.ru/media/cache/resolve/blurred_facade/uploads/facade/17884/64f986e9e4280.png",
    polygons: [
      {
        id: "1ecf0b3d2e28d",
        points: [
          [1013.6230182647705, 703.7335543632507],
          [1240.9666872024536, 747.13978099823],
          [1737.933373451233, 728.6410002708435],
          [1743.4587502479553, 657.0810990333557],
          [1238.1966352462769, 665.6810574531555],
          [1011.5519118309021, 636.1061315536499],
          [1013.6230182647705, 703.7335543632507],
        ],
        section: "1",
        floor: "6",
      },
    ],
  },
  {
    id: "1h475hf73md",
    image:
      "https://pb17884.profitbase.ru/media/cache/resolve/blurred_facade/uploads/facade/17884/64f986e9e4280.png",
    polygons: [
      {
        id: "1ecf0b3d2e28d",
        points: [
          [1013.6230182647705, 703.7335543632507],
          [1240.9666872024536, 747.13978099823],
          [1737.933373451233, 728.6410002708435],
          [1743.4587502479553, 657.0810990333557],
          [1238.1966352462769, 665.6810574531555],
          [1011.5519118309021, 636.1061315536499],
          [1013.6230182647705, 703.7335543632507],
        ],
        section: "1",
        floor: "6",
      },
    ],
  },
]);
const { start, optionsFloor, changeFacade } = useViewFacades(facades.value);

onMounted(() => {
  start();
});
</script>

<style scoped lang="scss">
.chessFacade {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: flex-start;
  align-items: flex-start;
  .prev,
  .next {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 100px;
    height: 100px;
    z-index: 2;

    svg {
      width: 100%;
      height: 100%;
    }
  }
  .prev {
    left: 200px;
  }
  .next {
    right: 200px;
  }
  .map {
    width: 100%;
    height: 100%;
    overflow-x: scroll;
  }
  #background-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    filter: blur(5px); /* Размытие изображения */
    pointer-events: none; /* Чтобы изображение не перекрывало интерактивные элементы карты */
  }

  @media screen and (max-width: 1600px) {
    .prev,
    .next {
      width: 50px;
      height: 50px;
    }
    .prev {
      left: 100px;
    }
    .next {
      right: 100px;
    }
  }
}
</style>
